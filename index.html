<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luna Chatbot</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    #luna-app-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      z-index: 10000;
    }
    
    .luna-chat-container {
      width: 100%;
      max-width: 500px;
      height: 100vh;
      max-height: 900px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .luna-header {
      padding: 16px;
      border-bottom: 1px solid #e5e5e5;
      text-align: center;
      background: #f7f7f7;
    }
    
    .luna-header h1 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
    }
    
    .luna-chat-box {
      flex-grow: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .luna-message {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.4;
      font-size: 0.95rem;
      word-wrap: break-word;
    }
    
    .luna-user-message {
      background: #007aff;
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .luna-luna-message {
      background: #e5e5ea;
      color: #333;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    
    .luna-typing {
      background: #e5e5ea;
      color: #999;
      font-style: italic;
    }
    
    .luna-input-form {
      display: flex;
      padding: 12px;
      border-top: 1px solid #e5e5e5;
      background: #f7f7f7;
      gap: 8px;
    }
    
    .luna-input-form input {
      flex-grow: 1;
      border: 1px solid #dcdcdc;
      border-radius: 20px;
      padding: 10px 16px;
      font-size: 0.95rem;
      outline: none;
      font-family: inherit;
    }
    
    .luna-input-form input:focus {
      border-color: #007aff;
    }
    
    .luna-input-form button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px 12px;
      color: #007aff;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .luna-input-form button:active {
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <script>
    (function() {
      // Erstelle den HTML-Container
      const container = document.createElement('div');
      container.id = 'luna-app-container';
      container.innerHTML = `
        <div class="luna-chat-container">
          <div class="luna-header">
            <h1>üåô Plaudere mit Luna</h1>
          </div>
          <div class="luna-chat-box" id="luna-chat-box"></div>
          <form class="luna-input-form" id="luna-chat-form">
            <input 
              type="text" 
              id="luna-user-input" 
              placeholder="Schreibe eine Nachricht..." 
              autocomplete="off"
            >
            <button type="submit" title="Senden">‚úàÔ∏è</button>
          </form>
        </div>
      `;
      
      document.body.appendChild(container);
      
      setTimeout(() => {
        const chatBox = document.getElementById('luna-chat-box');
        const chatForm = document.getElementById('luna-chat-form');
        const userInput = document.getElementById('luna-user-input');
        
        if (!chatBox || !chatForm || !userInput) {
          console.error('Luna-Elemente nicht gefunden');
          return;
        }
        
        let chatHistory = JSON.parse(localStorage.getItem('luna-chat-history')) || [];
        
        function addMessage(text, sender) {
          const messageEl = document.createElement('div');
          messageEl.className = `luna-message luna-${sender}-message`;
          messageEl.textContent = text;
          chatBox.appendChild(messageEl);
          chatBox.scrollTop = chatBox.scrollHeight;
          
          chatHistory.push({ sender, text, timestamp: new Date().toISOString() });
          localStorage.setItem('luna-chat-history', JSON.stringify(chatHistory));
        }
        
        addMessage('Hallo! Ich bin Luna. Ich freue mich, mit dir zu plaudern. Was m√∂chtest du heute entdecken oder erfinden?', 'luna');
        
        function getLunaResponse(userMessage) {
          const msg = userMessage.toLowerCase();
          
          const blockedWords = ['gewalt', 't√∂ten', 'hass', 'b√∂se'];
          if (blockedWords.some(word => msg.includes(word))) {
            return 'Das ist ein Thema, √ºber das ich nicht sprechen kann. Lass uns √ºber etwas anderes plaudern! Was interessiert dich noch?';
          }
          
          if (msg.includes('bruch')) {
            return 'Klar, Bruchrechnung! Das ist ein super wichtiges Thema. Wo h√§ngst du denn fest? Beschreib mir die Aufgabe, und wir gehen sie zusammen Schritt f√ºr Schritt durch!';
          }
          
          if (msg.includes('hausaufgabe')) {
            return 'Gerne helfe ich dir bei deinen Hausaufgaben! Welches Fach ist es denn? Und was ist die konkrete Aufgabe?';
          }
          
          if (msg.includes('geschichte') || msg.includes('deutsch') || msg.includes('englisch')) {
            return 'Das ist ein spannendes Thema! Erz√§hl mir mehr, und ich helfe dir gerne weiter.';
          }
          
          if (msg.includes('wer bist du') || msg.includes('who are you')) {
            return 'Hallo! Ich bin Luna, deine freundliche KI-Assistentin. Ich bin hier, um dir bei Fragen zu helfen, dich beim Lernen zu unterst√ºtzen und mit dir kreativ zu sein. Stell mir einfach eine Frage!';
          }
          
          if (msg.includes('vulkan') || msg.includes('natur') || msg.includes('science')) {
            return 'Wow, Naturwissenschaften sind spannend! Ich liebe solche Fragen. Was genau m√∂chtest du √ºber dieses Thema wissen?';
          }
          
          if (msg.includes('danke') || msg.includes('thanks')) {
            return 'Sehr gerne! Das freut mich, dass ich dir helfen konnte. Hast du noch mehr Fragen?';
          }
          
          const defaultResponses = [
            'Das ist eine interessante Frage! Lass mich dar√ºber nachdenken... Was genau m√∂chtest du wissen?',
            'Das ist spannend! Kannst du mir ein bisschen mehr dar√ºber erz√§hlen?',
            'Gute Frage! Lass uns das zusammen herausfinden. Was denkst du denn selbst?',
            'Das klingt interessant! Ich helfe dir gerne weiter. Sag mir mehr!',
            'Hmm, das ist ein guter Punkt. Lass uns das Schritt f√ºr Schritt durchgehen.'
          ];
          
          return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }
        
        chatForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          const userMessage = userInput.value.trim();
          if (!userMessage) return;
          
          addMessage(userMessage, 'user');
          userInput.value = '';
          userInput.focus();
          
          const typingEl = document.createElement('div');
          typingEl.className = 'luna-message luna-luna-message luna-typing';
          typingEl.id = 'luna-typing';
          typingEl.textContent = 'Luna schreibt...';
          chatBox.appendChild(typingEl);
          chatBox.scrollTop = chatBox.scrollHeight;
          
          setTimeout(() => {
            const typing = document.getElementById('luna-typing');
            if (typing) typing.remove();
            
            const response = getLunaResponse(userMessage);
            addMessage(response, 'luna');
          }, 800 + Math.random() * 1200);
        });
        
        userInput.focus();
        
      }, 100);
    })();
  </script>
</body>
</html>